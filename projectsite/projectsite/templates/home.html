{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="content">
    <div class="container-fluid">
        <h4 class="page-title">Home</h4>
        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">PSUSphere</div>
                        <div class="card-category">Website ni Rex at Spled</div>
                    </div>
                    <div class="card-body">
                        Hello, Kalibutan
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="page-inner">
        <div class="page-title">Charts</div>
        <div class="page category">
        </div>
            <div class="row">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">New Members per Month</div>
                        </div>
                        <div class="card-body">
                            <div class="chart-container" style="height: 400px;">
                                <canvas id="lineChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Bar Chart</div>
                        </div>
                        <div class="card-body">
                            <div class="chart-container">
                                <canvas id="barChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Number of Students per Program</div>
                        </div>
                        <div class="card-body">
                            <div class="chart-container" style="height: 400px ;">
                                <canvas id="pieChart" style="width: 400; height: 400;"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card">
                      <div class="card-header">
                        <div class="card-title">Doughnut Chart</div>
                      </div>
                      <div class="card-body">
                        <div class="chart-container" style="height: 400px;">
                          <canvas id="doughnutChart" style="width: 50%; height: 50%"></canvas>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Radar Chart</div>
                        </div>
                        <div class="card-body">
                            <div class="chart-container" style="height: 400px;">
                                <canvas id="radarChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Bubble Chart</div>
                        </div>
                        <div class="card-body">
                            <div class="chart-container" style="height: 400px;">
                                <canvas id="bubbleChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6"> 
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Multiple Line Chart</div>
                        </div>
                        <div class="card-body">
                            <div class="chart-container">
                                <canvas id="multipleLineChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div> 
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Multiple Bar Chart</div>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="multipleBarChart"></canvas>
                        </div>
                    </div>
                </div>
        </div>
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <div class="card-title">Radar Chart</div>
                </div>
                <div class="card-body">
                    <div class="chart-container">
                        <canvas id="radarChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <div class="card-title">Bubble Chart</div>
                </div>
                <div class="card-body">
                    <div class="chart-container">
                        <canvas id="bubbleChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <div class="card-title">Multiple Line Chart</div>
                </div>
                <div class="card-body">
                    <div class="chart-container">
                        <canvas id="multipleLineChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <div class="card-title">Multiple Bar Chart</div>
                </div>
                <div class="card-body">
                    <div class="chart-container">
                        <canvas id="multipleBarChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-12">
            <div class="card">
                <div class="card-header">
                    <div class="card-title">Chart with HTML Legends</div>
                </div>
                <div class="card-body">
                    <div class="card-sub">Sometimes you need a very complex legend. In these cases, it makes sense to generate an HTML legend. Charts provide a generateLegend() method on their prototype that returns an HTML string for the legend.</div>>
                    <div class="chart-container">
                        <canvas id="htmlLegendsChart"></canvas>
                    </div>
                    <div id="myChartLegend">
                </div>
            </div>
        </div>
    </div>
    {% endblock %} 
    {% block chart %}
    <script>
        function loadChartData() {
            // pieChart
fetch("home/piechart/")
                .then((response) => response.json())
                .then((data) => {
                    console.log("Pie chart data:", data);
                    var studentCount = Object.keys(data); //labels
                    var counts = Object.values(data); // values
                    var pieChart = document.getElementById("pieChart").getContext("2d");

                    
    
                    new Chart(pieChart, {
                        type: "pie",
                        data: {
                            labels: studentCount,
                            datasets: [
                            {
                                data: counts,
                                backgroundColor: [            
                                "#1d7af3", "#f3545d", "#fdaf4b",
                                "#59d05d", "#2a8cd3", "#8e44ad",
                                "#e74c3c", "#f39c12", "#27ae60"
                            ],
                                borderWidth: 1,
                        },
                        ],
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        legend: {
                            position: "bottom",
                            labels: {
                                fontColor: "rgb(154, 154, 154)",
                                fontSize: 11,
                                usePointStyle: true,
                                padding: 20,
                            },
                        },
                        pieceLabel: {
                            render: "percentage",
                            fontColor: "white",
                            fontSize: 14,
                        },
                        tooltips: false,
                        layout: {
                            padding: {
                                left: 20,
                                right: 20,
                                top: 20,
                                bottom: 20,
                            },
                        },
                    },
                });
            })
            .catch((error) => console.error("Error:", error));
fetch("home/lineChart/")
    .then((response) => response.json())
    .then((data) => {
            var monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
            var result = Array(12).fill(0);

            Object.keys(data).forEach((month, index) => {
                var monthIndex = monthNames.indexOf(month);
                if (monthIndex>= 0) {
                    result[monthIndex] = data[month];
                }

            });
            var months = monthNames; //keys 
            var counts = result; // values
            var lineChart = document.getElementById("lineChart").getContext("2d");
            
            new Chart(lineChart, {
                type: "line",
                data: {
                  labels: months,
                  datasets: [
                    {
                      label: "New Members per Month",
                      borderColor: "#1d7af3",
                      pointBorderColor: "#FFF",
                      pointBackgroundColor: "#1d7af3",
                      pointBorderWidth: 2,
                      pointHoverRadius: 4,
                      pointHoverBorderWidth: 1,
                      pointRadius: 4,
                      backgroundColor: "transparent",
                      fill: true,
                      borderWidth: 2,
                      data: counts,
                    }
                ],
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        legend: {
                            position: "bottom",
                            labels: {
                                padding: 10,
                                fontColor: "#1d7af3",
                            },
                        },
                        tooltips: {
                            bodySpacing: 4,
                            mode: "nearest",
                            intersect: 0,
                            position: "nearest",
                            xPadding: 10,
                            yPadding: 10,
                            caretPadding: 10,
                        },
                        layout: {
                            padding: { left: 15, right: 15, top: 15, bottom: 15 },
                        },
                    },
                }
            });
        })
            .catch((error) => console.error("Error:", error));

fetch("home/barChart/")
        .then((response) => response.json())
        .then((data) => {
            console.log("Bar chart data:", data);
            var studentCount = Object.keys(data); //labels
            var counts = Object.values(data); // values
            var barChart = document.getElementById("barChart").getContext("2d");

                    new Chart(barChart, {
                        type: "bar",
                        data: {
                            labels: studentCount,
                            datasets: [
                            {
                                data: counts,
                                backgroundColor: [            
                                "#1d7af3", "#f3545d", "#fdaf4b",
                                "#59d05d", "#2a8cd3", "#8e44ad",
                                "#e74c3c", "#f39c12", "#27ae60"
                            ],
                                borderWidth: 1,
                        },
                        ],
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        legend: false,
                        pieceLabel: {
                            render: "percentage",
                            fontColor: "white",
                            fontSize: 11,
                        },
                        tooltips:{
                            enabled: true,
                            callbacks: {
                                label:function (tooltipItem, data) {
                                    return '${data.labels[tooltipItem.index]}: ${tooltipItem.value}';
                                },
                            },

                        },
                        layout: {
                            padding: {
                                left: 20,
                                right: 20,
                                top: 20,
                                bottom: 20,
                            },
                        },
                    },
                });
            })
            .catch((error) => console.error("Error:", error));

fetch("home/multibarChart/")
    .then((response) => response.json())
    .then((result) => {
                var severitylevel = Object.keys(result);
                var incidentCount_major = [];
                var incidentCounts_minor = [];
                var incidentCounts_moderate = [];

                var months = Object.keys(result);
                var counts = Object.values(result);

                function sortObjectKeys(obj) {
                    return Object.keys(obj).sort((a, b) => parseInt(a)- parseInt(b));
                }

                if (severitylevel.length >= 1) {
                    var sl1_data = result[severitylevel[0]];
                    var sortedKeys1 = sortObjectKeys(sl1_data);
                    incidentCount_major = sortedKeys1.map((key) => sl1_data[key]);
                }
                if (severitylevel.length >= 2) {
                    var sl2_data = result[severitylevel[1]];
                    var sortedKeys2 = sortObjectKeys(sl2_data);
                    incidentCount_minor = sortedKeys2.map((key) => sl2_data[key]);
                }
                if (severitylevel.length >= 2) {
                    var sl2_data = result[severitylevel[1]];
                    var sortedKeys2 = sortObjectKeys(sl2_data);
                    incidentCount_minor = sortedKeys2.map((key) => sl2_data[key]);
                }
                if (severitylevel.length >= 2) {
                    var sl2_data = result[severitylevel[1]];
                    var sortedKeys2 = sortObjectKeys(sl2_data);
                    incidentCount_minor = sortedKeys2.map((key) => sl2_data[key]);
                }
                if (severitylevel.length >= 3) {
                    var sl3_data = result[severitylevel[2]];
                    var sortedKeys3 = sortObjectKeys(sl3_data);
                    incidentCount_moderate = sortedKeys3.map((key) => sl3_data[key]);
                }
                var multipleBarChart = document.getElementById("multipleBarChart").getContext("2d");

                new Chart(multipleBarChart, {
                    type: "bar",
                    data: {
                        labels: ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct","Nov", "Dec"],
                        datasets: [
                            {
                                label: "Minor Fire",
                                backgroundColor: "#59d05d",
                                borderColor: "#59d05d",
                                data: incidentCount_minor,
                            },
                            {
                                label: "Moderate Fire",
                                backgroundColor: "#fdaf4b",
                                borderColor: "#fdaf4b",
                                data: incidentCount_moderate,
                            },
                            {
                                label: "Major Fire",
                                backgroundColor: "#177dff",
                                borderColor: "#177dff",
                                data: incidentCount_major,
                            },
                        ], 
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        legend: {
                            position: "bottom",
                        },
                        title: {
                            display: true,
                            text: "Fire Incidents by Severity Level",
                        },
                        tooltips: {
                            mode: "index",
                            intersect: false,
                        },
                        responsive: true,
                        scales: {
                            xAxes: [
                                {
                                    stacked: true,
                                },
                            ],
                            yAxes: [
                                {
                                    stacked: true,
                                },
                            ],  
                        }, 
                    },
                });
            })
            .catch((error) => console.error("Error:", error));
    }
loadChartData();
</script>

{%endblock%}
